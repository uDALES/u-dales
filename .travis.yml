# uDALES (https://github.com/uDALES/u-dales).
# Copyright (C) 2019 D. Meyer.

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

language: python

addons:
  apt:
    packages:
      - gfortran
      - libopenmpi-dev
      - openmpi-bin
      - libnetcdf-dev
      - libnetcdff-dev

matrix:
    include:
        - os: linux
          dist: xenial
          sudo: false
          python: 3.7
          env: BUILD_TYPE=Debug
        - os: linux
          dist: xenial
          sudo: false
          python: 3.7
          env: BUILD_TYPE=Release
        - os: osx
          language: generic
          env: BUILD_TYPE=Debug
        - os: osx
          language: generic
          env: BUILD_TYPE=Release

before_install:
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew update                     ; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install gcc netcdf open-mpi; fi

install:
  - mkdir build && pushd build
  - cmake -DCMAKE_BUILD_TYPE=$BUILD_TYPE ..
  - cmake --build .
  - popd

script:
  - mkdir temp && pushd temp
  - cp -r ../tests/examples/001/* .
  - mpiexec -np 2 ../build/u-dales namoptions.001
  - popd