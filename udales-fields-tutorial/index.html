
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the building-resolving urban multi-physics code uDALES">
      
      
        <meta name="author" content="The uDALES Team">
      
      
        <link rel="canonical" href="https://uDALES.github.io/u-dales/udales-fields-tutorial/">
      
      
        <link rel="prev" href="../udales-udbase-tutorial/">
      
      
        <link rel="next" href="../udales-facets-tutorial/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Flow fields and statistics - uDALES</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#working-with-udales-field-data-in-matlab" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="uDALES" class="md-header__button md-logo" aria-label="uDALES" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            uDALES
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Flow fields and statistics
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/uDALES/u-dales" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    u-dales
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="uDALES" class="md-nav__button md-logo" aria-label="uDALES" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    uDALES
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/uDALES/u-dales" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    u-dales
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Simulation inputs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Simulation inputs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-namoptions-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    List of input parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-boundary-conditions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Boundary conditions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-geometry-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geometry generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-copy-inputs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Copying from other simulations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-driver-simulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Precursor simulations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Running the simulation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Running the simulation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-pre-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-simulation-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running uDALES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-post-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Post-processing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data post-processing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Data post-processing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-udbase-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    udbase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Flow fields and statistics
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Flow fields and statistics
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initialising-udbase" class="md-nav__link">
    <span class="md-ellipsis">
      Initialising udbase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#udales-grid-layout" class="md-nav__link">
    <span class="md-ellipsis">
      uDALES grid layout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#averages-used-in-udales-output" class="md-nav__link">
    <span class="md-ellipsis">
      Averages used in uDALES output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_stat_xyt-loading-time-and-slab-averaged-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_stat_xyt: loading time- and slab-averaged data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_stat_t-loading-time-averaged-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_stat_t: loading time-averaged data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_field-loading-instantaneous-3d-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_field: loading instantaneous 3D data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_slice-loading-instantaneous-2d-slice-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_slice: loading instantaneous 2D slice data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_stat_tree-and-plot_tree-loading-and-plotting-tree-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_stat_tree and plot_tree: loading and plotting tree data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-facets-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Facets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-utility-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utility routines
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-example-simulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example simulations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-how-to-cite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to cite
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-pub-list/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Publication list
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DEVELOP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to contribute
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../udales-docs-software/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software docs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initialising-udbase" class="md-nav__link">
    <span class="md-ellipsis">
      Initialising udbase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#udales-grid-layout" class="md-nav__link">
    <span class="md-ellipsis">
      uDALES grid layout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#averages-used-in-udales-output" class="md-nav__link">
    <span class="md-ellipsis">
      Averages used in uDALES output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_stat_xyt-loading-time-and-slab-averaged-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_stat_xyt: loading time- and slab-averaged data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_stat_t-loading-time-averaged-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_stat_t: loading time-averaged data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_field-loading-instantaneous-3d-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_field: loading instantaneous 3D data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_slice-loading-instantaneous-2d-slice-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_slice: loading instantaneous 2D slice data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load_stat_tree-and-plot_tree-loading-and-plotting-tree-data" class="md-nav__link">
    <span class="md-ellipsis">
      load_stat_tree and plot_tree: loading and plotting tree data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="working-with-udales-field-data-in-matlab">Working with uDALES field data in MATLAB<a class="headerlink" href="#working-with-udales-field-data-in-matlab" title="Permanent link">&para;</a></h1>
<p>This tutorial describes how to read and process field data output of the LES code uDALES using MATLAB. In addition, it describes some important concepts, such as the <a href="#udales-grid-layout">grid layout</a>, <a href="#averages-used-in-udales-output">variable locations</a> and <a href="#averages-used-in-udales-output">averaging procedures</a>.</p>
<p>The <strong><code>udbase</code></strong> post-processing class reads in most important input parameters, and contains a number of methods to load field data:</p>
<ul>
<li><a href="#load_stat_xyt-loading-time-and-slab-averaged-data"><strong>load_stat_xyt</strong></a>. This method load the 1D slab- and time-averaged statistics from the file <code>xytdump.expnr.nc</code>. Several time-intervals may be present in the data.</li>
<li><a href="#load_stat_t-loading-time-averaged-data"><strong>load_stat_t</strong></a>. This method loads the 3D time-averaged statistics from the file <code>tdump.expnr.nc</code>. Several time-intervals may be present in the data.</li>
<li><a href="#load_stat_tree-and-plot_tree-loading-and-plotting-tree-data"><strong>load_stat_tree</strong></a>. This method loads the 3D time-averaged statistics of the tree source terms from the file <code>treedump.expnr.nc</code>. This method works exactly the same way as <code>load_stat_t</code>.</li>
<li><a href="#load_field-loading-instantaneous-3d-data"><strong>load_field</strong></a>. This method loads instantaneous 3D data from the file <code>fielddump.expnr.nc</code>. Several output times may be present in the data.</li>
<li><a href="#load_slice-loading-instantaneous-2d-slice-data"><strong>load_slice</strong></a>. This method loads instantaneous 2D slices of instantaneous 3D data from the file <code>Xslicedump.expnr.nc</code>. Several output times may be present in the data.</li>
<li><a href="#load_stat_tree-and-plot_tree-loading-and-plotting-tree-data"><strong>plot_trees</strong></a>. This method plots tree patches.</li>
</ul>
<p><strong>The live matlab file of this tutorial can be found in the repository in the folder /docs/tutorial_mlx.</strong></p>
<h2 id="initialising-udbase">Initialising udbase<a class="headerlink" href="#initialising-udbase" title="Permanent link">&para;</a></h2>
<p>The starting point of this tutorial is that you have run a simulation and have merged the output files. If the simulations were performed on a HPC system, <strong>we assume that you have copied the output directory to your own workstation</strong>. Some of the netCDF (*.nc) files may be very large and you may only want to copy these if you plan to analyse the data.</p>
<p><strong>Note that the uDALES/tools/matlab path must be added via the Set Path button in order to use the udbase class. Alternatively, it can be added using the addpath function inside the script (done here).</strong></p>
<div class="highlight"><pre><span></span><code><span class="c">% preamble</span>
<span class="nb">clear</span><span class="w"> </span><span class="n">variables</span>
<span class="nb">close</span><span class="w"> </span><span class="nb">all</span>

<span class="c">% add the uDALES matlab path</span>
<span class="nb">addpath</span><span class="p">(</span><span class="s">&#39;path_to_udales\tools\matlab&#39;</span><span class="p">)</span>

<span class="c">% create an instance of the udbase class</span>
<span class="n">expnr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">110</span><span class="p">;</span>
<span class="n">expdir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;path_to_experiments\110&#39;</span><span class="p">;</span>
<span class="n">sim</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">udbase</span><span class="p">(</span><span class="n">expnr</span><span class="p">,</span><span class="w"> </span><span class="n">expdir</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Warning: prof.inp.110 not found. Assuming equidistant grid.
</code></pre></div>
<h2 id="udales-grid-layout">uDALES grid layout<a class="headerlink" href="#udales-grid-layout" title="Permanent link">&para;</a></h2>
<p>uDALES uses a grid that is staggered, which means that not all variables are defined at the same location on the grid. Staggering is computationally advantageous [1], but requires care with plotting, as it is imporant to plot variables in their correct location. uDALES' grid layout is as follows.</p>
<div class="highlight"><pre><span></span><code><span class="c">% 2D view of staggered grid arrangement</span>
<span class="c">% (x-z direction; grid layout in other directions is identical)</span>
<span class="c">%</span>
<span class="c">%                           w(i,j,k+1)</span>
<span class="c">%                               ^</span>
<span class="c">% zm(k+1) --            --------|--------</span>
<span class="c">%                       |               |</span>
<span class="c">%                       |   c(i,j,k)    |</span>
<span class="c">%   zt(k) --  u(i,j,k) ---&gt;     o      ---&gt; u(i+1,j,k)</span>
<span class="c">%                       |               |</span>
<span class="c">%                       |       ^       |</span>
<span class="c">%   zm(k) --            --------|--------</span>
<span class="c">%                           w(i,j,k)</span>
<span class="c">%</span>
<span class="c">%                       |       |       |</span>
<span class="c">%                     xm(i)   xt(i)   xm(i+1)</span>
<span class="c">%</span>
<span class="c">%   Coordinate positions (assuming z-grid is equidistant)</span>
<span class="c">%   xm(i) = (i-1) * dx;     xt(i) = (i-1/2) * dx</span>
<span class="c">%   ym(j) = (j-1) * dy;     yt(j) = (j-1/2) * dy</span>
<span class="c">%   zm(k) = (k-1) * dz;     zt(k) = (k-1/2) * dz</span>
<span class="c">%</span>
<span class="c">%   Grid increments:</span>
<span class="c">%   dzt(k) = zm(k+1) - zm(k)</span>
<span class="c">%   dzm(k) = zt(k) - zt(k-1)</span>
<span class="c">%</span>
<span class="c">%   Note that z does not have to be equidistant.</span>
</code></pre></div>
<p>There are six arrays for the coordinates:</p>
<ul>
<li><code>xm.</code> x-coordinate of cell edges</li>
<li><code>xt.</code> x-coordinate of cell centres</li>
<li><code>ym.</code> y-coordinate of cell edges</li>
<li><code>yt.</code> y-coordinate of cell centres</li>
<li><code>zm.</code> z-coordinate of cell edges</li>
<li><code>zt.</code> z-coordinate of cell centres</li>
</ul>
<p>The field variables are defined as follows</p>
<ul>
<li><code>u(i,j,k)</code> is the u-velocity at location <code>(xm(i),yt(j),zt(k))</code></li>
<li><code>v(i,j,k)</code> is the v-velocity at location <code>(xt(i),ym(j),zt(k))</code></li>
<li><code>w(i,j,k)</code> is the w-velocity at location <code>(xt(i),yt(j),zm(k))</code></li>
<li><code>c(i,j,k)</code> is a scalar quantity at location <code>(xt(i),yt(j),zt(k))</code>  </li>
</ul>
<p>Scalars (potential temperature, specific humidity, pollutants) are always defined in the cell-centre. Fluxes are typically defined on the cell edges.</p>
<p><strong>You can always look up where the variables are defined from the output variable information using the load.. methods.</strong></p>
<h2 id="averages-used-in-udales-output">Averages used in uDALES output<a class="headerlink" href="#averages-used-in-udales-output" title="Permanent link">&para;</a></h2>
<p>Many of the outputs of uDALES have been averaged in some manner. This is advantageous as these are often the quantities we are interested in, and also require much less diskspace and memory to process.</p>
<p>The Reynolds decomposition is used to decompose variables into mean quantities and their fluctuations [2]:</p>
<p><span class="arithmatex"><span class="MathJax_Preview">\varphi \left(x,y,z,t\right)=\bar{\varphi \;} \left(x,y,z\right)+\varphi {\;}^{\prime } \left(x,y,z,t\right)</span><script type="math/tex">\varphi \left(x,y,z,t\right)=\bar{\varphi \;} \left(x,y,z\right)+\varphi {\;}^{\prime } \left(x,y,z,t\right)</script></span>,</p>
<p>where the overbar denotes time-averaging. The time-averaged data is contained in the <code>tdump.expnr.nc</code> file.</p>
<p>Often, we are interested in the quantities that are additionally averaged in the horizontal plane. This is often referred to as a <strong>slab average</strong>.  In this case it is common to further decompose the time-averaged quantity <span class="arithmatex"><span class="MathJax_Preview">\bar{\varphi}</span><script type="math/tex">\bar{\varphi}</script></span> into a spatial average <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{\varphi} \rangle \left(z\right)</span><script type="math/tex">\langle \bar{\varphi} \rangle \left(z\right)</script></span> (i.e., average over the horizontal surface)  and its spatial variation <span class="arithmatex"><span class="MathJax_Preview">\bar{\varphi} \textrm{"}\left(x,y,z\right)=\bar{\varphi} \left(x,y,z\right)-\langle \bar{\varphi} \rangle \left(z\right)</span><script type="math/tex">\bar{\varphi} \textrm{"}\left(x,y,z\right)=\bar{\varphi} \left(x,y,z\right)-\langle \bar{\varphi} \rangle \left(z\right)</script></span>. Upon substituting this expression into the equation above, we obtain the triple decomposition [3]:</p>
<p><span class="arithmatex"><span class="MathJax_Preview">\varphi \left(x,y,z,t\right)=\langle \bar{\varphi} \rangle \left(z\right)+\bar{\varphi} \textrm{"}\left(x,y,z\right)\;+\varphi^{\prime } \left(x,y,z,t\right)</span><script type="math/tex">\varphi \left(x,y,z,t\right)=\langle \bar{\varphi} \rangle \left(z\right)+\bar{\varphi} \textrm{"}\left(x,y,z\right)\;+\varphi^{\prime } \left(x,y,z,t\right)</script></span>.</p>
<p>Here, <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{\varphi \;} \rangle</span><script type="math/tex">\langle \bar{\varphi \;} \rangle</script></span> is an <em>intrinsic</em> average, defined as [3]</p>
<p>$$ \langle \bar{\varphi} \rangle \;\left(z\right)=\frac{1}{A_f }\int_{\Omega_{f\;} } \varphi \;\mathrm{dA} $$</p>
<p>where <span class="arithmatex"><span class="MathJax_Preview">A_f \left(z\right)</span><script type="math/tex">A_f \left(z\right)</script></span> is the area occupied by fluid and <span class="arithmatex"><span class="MathJax_Preview">\Omega_f</span><script type="math/tex">\Omega_f</script></span> is the horizontal surface that is occupied by the fluid. The quantity <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{\varphi} \rangle</span><script type="math/tex">\langle \bar{\varphi} \rangle</script></span> represents the average value of <span class="arithmatex"><span class="MathJax_Preview">\bar{\varphi}</span><script type="math/tex">\bar{\varphi}</script></span> inside the fluid between the buildings. Another commonly used quantity is the <em>comprehensive</em> average <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{\varphi} \rangle_C</span><script type="math/tex">\langle \bar{\varphi} \rangle_C</script></span>, which is defined as</p>
<p>$$ \langle \bar{\varphi} \rangle_C \left(z\right)=\frac{1}{A}\int_{\Omega_{f\;} } \varphi \;\mathrm{dA}=\frac{A_f }{A}\langle \bar{\varphi} \rangle \left(z\right) $$</p>
<p>where <span class="arithmatex"><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> is the total surface area. In many cases, it is more convenient to work with comprehensive averages than intrinsic averages, particularly when considering averaged budgets of momentum, temperature etc [3]. To convert the intrinsic-average output from uDALES into a comprehensive average, simply multiply the intrinsic average by <span class="arithmatex"><span class="MathJax_Preview">A_f /A</span><script type="math/tex">A_f /A</script></span> as shown above. Time and intrinsically-averaged data is contained in the <code>xytdump.expnr.nc</code> file.</p>
<h2 id="load_stat_xyt-loading-time-and-slab-averaged-data">load_stat_xyt: loading time- and slab-averaged data<a class="headerlink" href="#load_stat_xyt-loading-time-and-slab-averaged-data" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nb">help</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>--- help for udbase/load_stat_xyt ---

  A method to retrieve plane- and time-averaged 1D statistics
  information from the xytdump file.  

  load_stat_xyt(OBJ) displays the variables in the xytdump file

  load_stat_xyt(OBJ, svar) retrieves a variable from the xytdump file

  Example (view contents of output):
    obj = udbase(expnr);
    obj.load_stat_xyt();
</code></pre></div>
<p>This method loads a single output variable <code>var</code> at a time. In order to understand which variables are present in the output file, call the method without input arguments.</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Contents of xytdump.110.nc:
       Name                     Description                  Units     Size     Dimensions
    ___________    _____________________________________    _______    _____    __________

    pxyt           Pressure                                 kgm/s^2    256x3     zt, time
    qtxyt          Moisture                                 kg/kg      256x3     zt, time
    thlpthlptxy    Temp. variance                           K^2        256x3     zt, time
    thlsgsxyt      SGS heat flux                            K m/s      256x3     zm, time
    thlxyt         Temperature                              K          256x3     zt, time
    time           Time                                     s          3         time
    tketxyc        tke                                      m^2/s^2    256x3     zt, time
    upuptxyc       u variance                               m^2/s^2    256x3     zt, time
    upvpxyt        Turbulent mom. flux                      m^2/s^2    256x3     zm, time
    upwpxyt        Turbulent mom. flux                      m^2/s^2    256x3     zm, time
    usgsxyt        SGS mom. flux                            m^2/s^2    256x3     zm, time
    uvxyt          Kinematic mom. flux                      m^2/s^2    256x3     zm, time
    uwxyt          Kinematic mom. flux                      m^2/s^2    256x3     zm, time
    uxyt           Streamwise velocity                      m/s        256x3     zt, time
    vpvptxyc       v variance                               m^2/s^2    256x3     zt, time
    vpwpxyt        Turbulent mom. flux                      m^2/s^2    256x3     zm, time
    vsgsxyt        SGS mom. flux                            K m/s      256x3     zm, time
    vwxyt          Kinematic mom. flux                      m^2/s^2    256x3     zm, time
    vxyt           Spanwise velocity                        m/s        256x3     zt, time
    wpthlpxyt      Turbulent heat flux                      K m/s      256x3     zm, time
    wpwptxyc       w variance                               m^2/s^2    256x3     zt, time
    wthlxyt        Kinematic heat flux                      K m/s      256x3     zm, time
    wwxyt          Kinematic mom. flux                      m^2/s^2    256x3     zm, time
    wxyt           Vertical velocity                        m/s        256x3     zm, time
    zm             Vertical displacement of cell edges      m          256       zm
    zt             Vertical displacement of cell centers    m          256       zt
</code></pre></div>
<p>Before showing how to display the data, we note that the variable <code>'time'</code> has a size <code>1</code> <span class="arithmatex"><span class="MathJax_Preview">\times</span><script type="math/tex">\times</script></span> <code>3</code>. Let's load the data to see what is inside.</p>
<div class="highlight"><pre><span></span><code><span class="n">txyt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>txyt = 3x1 single column vector
1.0e+03
2.0001
4.0001
6.0001
</code></pre></div>
<p>There are three times at which output has been generated. This can be understood by considering the input parameter values</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">tstatsdump</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ans = 2000
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">runtime</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ans = 6002
</code></pre></div>
<p>Therefore, the entire runtime is divided into 3 time intervals, in each of which the time average is taken.</p>
<p>The vertical coordinate <span class="arithmatex"><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span> and mean streamwise velocity <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{u} \rangle</span><script type="math/tex">\langle \bar{u} \rangle</script></span> can be loaded as:</p>
<div class="highlight"><pre><span></span><code><span class="n">zm</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span><span class="p">(</span><span class="s">&#39;zm&#39;</span><span class="p">);</span>
<span class="n">uxyt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span><span class="p">(</span><span class="s">&#39;uxyt&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Since <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{u} \rangle</span><script type="math/tex">\langle \bar{u} \rangle</script></span> is the streamwise velocity, it is defined in the vertical cell-center and should thus be plotted against <code>zm</code>. We plot <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{u} \rangle</span><script type="math/tex">\langle \bar{u} \rangle</script></span> for each averaging time interval below.</p>
<div class="highlight"><pre><span></span><code><span class="n">tstart</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">leg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">txyt</span><span class="p">));</span><span class="w"> </span><span class="c">% create a cell array to store each of the legend entries</span>
<span class="nb">figure</span>
<span class="nb">hold</span><span class="w"> </span><span class="n">on</span>
<span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">txyt</span><span class="p">)</span>
<span class="w">    </span><span class="nb">plot</span><span class="p">(</span><span class="n">uxyt</span><span class="p">(:,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">zm</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Linewidth&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">leg</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;$t=&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;%8.0f&#39;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">txyt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;%8.0f&#39;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;$s&#39;</span><span class="p">];</span>
<span class="w">    </span><span class="n">tstart</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">txyt</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="k">end</span>
<span class="nb">hold</span><span class="w"> </span><span class="n">off</span>
<span class="nb">box</span><span class="w"> </span><span class="n">on</span>
<span class="nb">ylabel</span><span class="w"> </span><span class="p">(</span><span class="s">&#39;$z$ [m]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="w"> </span><span class="p">(</span><span class="s">&#39;$\langle \overline{u} \rangle$ [m/s]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">legend</span><span class="p">(</span><span class="n">leg</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;northwest&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_0.png" src="../udales-fields-tutorial_media/figure_0.png" /></p>
<p>As can be seen, during the first time-interval, the flow is substantially slower than in the other two intervals, suggesting an initial transient. Although the profiles for last two time-intervals are close, they are not identical showing that either the flow has not equilibriated entirely, or the chosen averaging time-interval was too small, or both.</p>
<p>Using the continuity equation it can be shown that for period domains <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{w} \rangle =0</span><script type="math/tex">\langle \bar{w} \rangle =0</script></span>, which also implies that <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{w} \textrm{"}\rangle =0</span><script type="math/tex">\langle \bar{w} \textrm{"}\rangle =0</script></span>. This means that the dispersive momentum flux <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{u\;} \textrm{"}\bar{w\;} \textrm{"}\rangle</span><script type="math/tex">\langle \bar{u\;} \textrm{"}\bar{w\;} \textrm{"}\rangle</script></span> is equal to <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{\;u} \;\bar{\;w} \rangle</span><script type="math/tex">\langle \bar{\;u} \;\bar{\;w} \rangle</script></span>. Thus, we can load the mean turbulent horizontal momentum flux <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{u^{\prime } w^{\prime } } \rangle</span><script type="math/tex">\langle \bar{u^{\prime } w^{\prime } } \rangle</script></span> and dispersive flux <span class="arithmatex"><span class="MathJax_Preview">\langle \bar{u\;} \textrm{"}\bar{w\;} \textrm{"}\rangle</span><script type="math/tex">\langle \bar{u\;} \textrm{"}\bar{w\;} \textrm{"}\rangle</script></span> can be loaded as:</p>
<div class="highlight"><pre><span></span><code><span class="n">zt</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span><span class="p">(</span><span class="s">&#39;zt&#39;</span><span class="p">);</span><span class="w">      </span><span class="c">% location of vertical fluxes of horizontal momentum</span>
<span class="n">upwpxyt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span><span class="p">(</span><span class="s">&#39;upwpxyt&#39;</span><span class="p">);</span><span class="w"> </span><span class="c">% turbulence fluxes (p indicates prime)</span>
<span class="n">uwxyt</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_xyt</span><span class="p">(</span><span class="s">&#39;uwxyt&#39;</span><span class="p">);</span><span class="w">   </span><span class="c">% dispersive fluxes</span>
</code></pre></div>
<p>Note that these terms should be plotted against against <code>zt</code> (cell center) since they represent the vertical exchange of horizontal momentum. Again, we plot the averages for each time interval (now we can do this more compactly as we do not need to create the legend entries):</p>
<div class="highlight"><pre><span></span><code><span class="nb">figure</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">upwpxyt</span><span class="p">,</span><span class="w"> </span><span class="n">zt</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="w"> </span><span class="p">(</span><span class="s">&#39;$\langle \overline{u^\prime w^\prime} \rangle$ [m$^2$/s$^2$]&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="w"> </span><span class="p">(</span><span class="s">&#39;$z$ [m]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="w"> </span><span class="mi">0</span><span class="p">])</span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">uwxyt</span><span class="p">,</span><span class="w"> </span><span class="n">zt</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="w"> </span><span class="p">([</span><span class="s">&#39;$\langle \overline{u}^{\prime\prime} \overline{w}^{\prime\prime} \rangle$&#39;</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39; [m$^2$/s$^2$]&#39;</span><span class="p">],</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="w"> </span><span class="mi">0</span><span class="p">])</span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">uwxyt</span><span class="o">+</span><span class="n">upwpxyt</span><span class="p">,</span><span class="w"> </span><span class="n">zt</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="w"> </span><span class="p">([</span><span class="s">&#39;$\langle \overline{u^\prime w^\prime} \rangle+\langle \overline{u}^{\prime\prime} \overline{w}^{\prime\prime} \rangle$&#39;</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39; [m$^2$/s$^2$]&#39;</span><span class="p">],</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="w"> </span><span class="mi">0</span><span class="p">])</span>
<span class="nb">legend</span><span class="p">(</span><span class="n">leg</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;northwest&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_1.png" src="../udales-fields-tutorial_media/figure_1.png" /></p>
<p>To interpret this data, it is easiest to start with the right-most figure which plots the sum of the dispersive and turbulent fluxes. In a steady state (and for a simulation with a constant pressure gradient of average velocity), we expect this quantity to form a straight line, which is the case for the last two time-intervals. The data are also nearly collapsing for the last two time-intervals, once more suggesting that these flows are close to a statistical steady state.</p>
<p>The turbulent and dispersive fluxes show substantial variation for all three curves, showing that much longer averaging is needed to obtain reliable statistics for these quantities [4].</p>
<h2 id="load_stat_t-loading-time-averaged-data">load_stat_t: loading time-averaged data<a class="headerlink" href="#load_stat_t-loading-time-averaged-data" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nb">help</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_t</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>--- help for udbase/load_stat_t ---

  A method to retrieve time-averaged statistics from the tdump file

  load_stat_t(OBJ) displays the variables in the tdump file

  load_stat_t(OBJ, svar) retrieves a variable from the tdump file

  Example (view contents of output):
    obj = udbase(expnr);
    obj.load_stat_t();
</code></pre></div>
<p>The time-averaged field data is stored in the <code>tdump.expnr.nc</code> file. The variables it contains can be listed as:</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_t</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Contents of tdump.110.nc:
       Name                      Description                    Units         Size            Dimensions
    ___________    ________________________________________    _______    _____________    ________________

    PSS            PSS defect                                  gm/s       128x128x256x3    xt, yt, zt, time
    pt             Pressure                                    kgm/s^2    128x128x256x3    xt, yt, zt, time
    qtt            Moisture                                    kg/kg      128x128x256x3    xt, yt, zt, time
    sca1psca1pt    Concentration variance 1                    g^2/m^6    128x128x256x3    xt, yt, zt, time
    sca1t          Concentration field 1                       g/m^3      128x128x256x3    xt, yt, zt, time
    sca2psca2pt    Concentration variance 2                    g^2/m^6    128x128x256x3    xt, yt, zt, time
    sca2t          Concentration field 2                       g/m^3      128x128x256x3    xt, yt, zt, time
    sca3psca3pt    Concentration variance 3                    g^2/m^6    128x128x256x3    xt, yt, zt, time
    sca3t          Concentration field 3                       g/m^3      128x128x256x3    xt, yt, zt, time
    sca4psca4pt    Concentration variance 4                    g^2/m^6    128x128x256x3    xt, yt, zt, time
    sca4t          Concentration field 4                       g/m^3      128x128x256x3    xt, yt, zt, time
    sv1sgs         SGS flux 1                                  gm/s       128x128x256x3    xt, yt, zm, time
    sv2sgs         SGS flux 2                                  gm/s       128x128x256x3    xt, yt, zm, time
    sv3sgs         SGS flux 3                                  gm/s       128x128x256x3    xt, yt, zm, time
    sv4sgs         SGS flux 4                                  gm/s       128x128x256x3    xt, yt, zm, time
    thlpthlpt      Temperature variance                        K^2        128x128x256x3    xt, yt, zt, time
    thlt           Temperature                                 K          128x128x256x3    xt, yt, zt, time
    time           Time                                        s          3                time
    tketc          TKE                                         m^2/s^2    128x128x256x3    xt, yt, zt, time
    upuptc         u variance                                  m^2/s^2    128x128x256x3    xt, yt, zt, time
    upvpt          Turbulent momentum flux                     m^2/s^2    128x128x256x3    xm, ym, zt, time
    upwpt          Turbulent momentum flux                     m^2/s^2    128x128x256x3    xm, yt, zm, time
    ut             Streamwise velocity                         m/s        128x128x256x3    xm, yt, zt, time
    vpvptc         v variance                                  m^2/s^2    128x128x256x3    xt, yt, zt, time
    vpwpt          Turbulent momentum flux                     m^2/s^2    128x128x256x3    xt, ym, zm, time
    vt             Spanwise velocity                           m/s        128x128x256x3    xt, ym, zt, time
    wpsca1pt       Turbulent flux 1                            gm/s       128x128x256x3    xt, yt, zm, time
    wpsca2pt       Turbulent flux 2                            gm/s       128x128x256x3    xt, yt, zm, time
    wpsca3pt       Turbulent flux 3                            gm/s       128x128x256x3    xt, yt, zm, time
    wpsca4pt       Turbulent flux 4                            gm/s       128x128x256x3    xt, yt, zm, time
    wpthlpt        Turbulent heat flux                         K m/s      128x128x256x3    xt, yt, zm, time
    wpwptc         w variance                                  m^2/s^2    128x128x256x3    xt, yt, zt, time
    wt             Vertical velocity                           m/s        128x128x256x3    xt, yt, zm, time
    xm             West-East displacement of cell edges        m          128              xm
    xt             West-East displacement of cell centers      m          128              xt
    ym             South-North displacement of cell edges      m          128              ym
    yt             South-North displacement of cell centers    m          128              yt
    zm             Vertical displacement of cell edges         m          256              zm
    zt             Vertical displacement of cell centers       m          256              zt
</code></pre></div>
<p>We load the time-averaged streamwise velocity field u, and the coordinates it relates to. <strong>Note that the appropriate coordinate arrays are listed in the 'Dimensions' column above.</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">ut</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_t</span><span class="p">(</span><span class="s">&#39;ut&#39;</span><span class="p">);</span>
<span class="n">tt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_t</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">);</span>
<span class="n">xm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_t</span><span class="p">(</span><span class="s">&#39;xm&#39;</span><span class="p">);</span><span class="w"> </span><span class="c">% we are interested in plotting u  </span>
<span class="n">yt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_t</span><span class="p">(</span><span class="s">&#39;yt&#39;</span><span class="p">);</span>
<span class="n">zt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_t</span><span class="p">(</span><span class="s">&#39;zt&#39;</span><span class="p">);</span>
</code></pre></div>
<p>We plot a horizontal slice at the mean building height <code>z=10m</code>, choosing to use the statistics of the last time-interval</p>
<div class="highlight"><pre><span></span><code><span class="c">% find the k-index closest to z=10 m</span>
<span class="n">zloc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">zloc</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">zloc</span><span class="p">)),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="c">% choose last time interval</span>
<span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">tt</span><span class="p">);</span>

<span class="n">figure</span>
<span class="s">pcolor(xm,</span><span class="w"> </span><span class="s">yt,</span><span class="w"> </span><span class="s">squeeze(ut(:,:,k,n))&#39;);</span>
<span class="s">shading flat; axis equal tight; colorbar</span>
<span class="s">xlabel(&#39;$x$</span><span class="w"> </span><span class="s">[m]&#39;, &#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="s">ylabel(&#39;$y$</span><span class="w"> </span><span class="s">[m]&#39;, &#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="s">title([&#39;$\overline</span><span class="w"> </span><span class="s">u(x,</span><span class="w"> </span><span class="s">y,</span><span class="w"> </span><span class="s">z=&#39;, num2str(zt(k), &#39;%8.1f&#39;), &#39;m)$</span><span class="p">;</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="s">NaNs&#39;], &#39;Interpreter&#39;,&#39;latex</span><span class="o">&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_2.png" src="../udales-fields-tutorial_media/figure_2.png" /></p>
<p>You can see that where the buildings are, the velocity is zero. However, since this is a solid domain, you will want to remove these from the plot. You can use the arrays  <code>Su, Sv, Sw</code> and <code>Sc</code> in the sim object for this, which are 3D boolean matrices that indicate the cells contain buildings as true. There are four different arrays since the grid is staggered. We are dealing with the u-velocity, so will use the array <code>Su</code>. In order to do so, we can simply set the cells that contain solid elements to <code>NaN</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">curut</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ut</span><span class="p">(:,:,:,</span><span class="n">n</span><span class="p">);</span>
<span class="n">curut</span><span class="p">(</span><span class="n">sim</span><span class="p">.</span><span class="n">Su</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">NaN</span><span class="p">;</span>

<span class="n">figure</span>
<span class="s">pcolor(xm,</span><span class="w"> </span><span class="s">yt,</span><span class="w"> </span><span class="s">squeeze(curut(:,:,k))&#39;);</span>
<span class="s">shading flat; axis equal tight; colorbar</span>
<span class="s">xlabel(&#39;$x$</span><span class="w"> </span><span class="s">[m]&#39;, &#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="s">ylabel(&#39;$y$</span><span class="w"> </span><span class="s">[m]&#39;, &#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="s">title([&#39;$\overline</span><span class="w"> </span><span class="s">u(x,</span><span class="w"> </span><span class="s">y,</span><span class="w"> </span><span class="s">z=&#39;, num2str(zt(k), &#39;%8.1f&#39;), &#39;m)$&#39;], &#39;Interpreter&#39;,&#39;latex</span><span class="o">&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_3.png" src="../udales-fields-tutorial_media/figure_3.png" /></p>
<p>Similarly, we can plot a vertical slice in the middle of the y-domain as follows.</p>
<div class="highlight"><pre><span></span><code><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">jtot</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c">% select the index in the middle of the domain span</span>

<span class="nb">figure</span>
<span class="nb">pcolor</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span><span class="w"> </span><span class="n">zt</span><span class="p">,</span><span class="w"> </span><span class="nb">squeeze</span><span class="p">(</span><span class="n">curut</span><span class="p">(:,</span><span class="nb">j</span><span class="p">,:))</span><span class="o">&#39;</span><span class="p">);</span>
<span class="n">shading</span><span class="w"> </span><span class="s">flat</span><span class="p">;</span><span class="w"> </span><span class="n">axis</span><span class="w"> </span><span class="s">equal</span><span class="w"> </span><span class="s">tight</span><span class="p">;</span><span class="w"> </span><span class="n">colorbar</span>
<span class="s">xlabel(&#39;$x$ [m]&#39;,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;$z$ [m]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">([</span><span class="s">&#39;$\overline u(x, y=&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">yt</span><span class="p">(</span><span class="nb">j</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;%8.1f&#39;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;m, z)$&#39;</span><span class="p">],</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_4.png" src="../udales-fields-tutorial_media/figure_4.png" /></p>
<h2 id="load_field-loading-instantaneous-3d-data">load_field: loading instantaneous 3D data<a class="headerlink" href="#load_field-loading-instantaneous-3d-data" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nb">help</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_field</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>--- help for udbase/load_field ---

   A method to retrieve instantaneous 3D data from from the fielddump file.

   load_field(OBJ) displays the variables in the fielddump file

   load_field(OBJ, svar) retrieves variable svar from the fielddump file

   Example (view contents of output):
     obj = udbase(expnr);
     obj.load_field();
</code></pre></div>
<p>The instantaneous field data is stored in the field<code>dump.expnr.nc</code> file, again, the variables it contains can be listed as:</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">load_field</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Contents of fielddump.110.nc:
    Name                  Description                   Units        Size            Dimensions
    ____    ________________________________________    _____    _____________    ________________

    time    Time                                         s       3                time
    u       West-East velocity                           m/s     128x128x256x3    xm, yt, zt, time
    v       South-North velocity                         m/s     128x128x256x3    xt, ym, zt, time
    w       Vertical velocity                            m/s     128x128x256x3    xt, yt, zm, time
    xm      West-East displacement of cell edges         m       128              xm
    xt      West-East displacement of cell centers       m       128              xt
    ym      South-North displacement of cell edges       m       128              ym
    yt      South-North displacement of cell centers     m       128              yt
    zm      Vertical displacement of cell edges          m       256              zm
    zt      Vertical displacement of cell centers        m       256              zt
</code></pre></div>
<p>The variable <code>time</code> contains the times at which output is written. Let's load the data to see which times these are</p>
<div class="highlight"><pre><span></span><code><span class="n">t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_field</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>t = 3x1 single column vector
1.0e+03
2.0000
4.0000
6.0000
</code></pre></div>
<p>These times can be understood by noticing that the output interval requested in the input file is</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">tfielddump</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ans = 2000
</code></pre></div>
<p>We load the data, once more using the horizontal velocity</p>
<div class="highlight"><pre><span></span><code><span class="n">u</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_field</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">);</span>
<span class="n">xm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_field</span><span class="p">(</span><span class="s">&#39;xm&#39;</span><span class="p">);</span>
<span class="n">yt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_field</span><span class="p">(</span><span class="s">&#39;yt&#39;</span><span class="p">);</span>
<span class="n">zt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_field</span><span class="p">(</span><span class="s">&#39;zt&#39;</span><span class="p">);</span>
</code></pre></div>
<p>We plot the instantaneous horizontal velocity at the same locations as in the previous section using the last output time</p>
<div class="highlight"><pre><span></span><code><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w"> </span><span class="c">% choose last output time</span>

<span class="c">% set the u-value inside buildings to NaN</span>
<span class="n">curu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u</span><span class="p">(:,:,:,</span><span class="n">n</span><span class="p">);</span>
<span class="n">curu</span><span class="p">(</span><span class="n">sim</span><span class="p">.</span><span class="n">Su</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">NaN</span><span class="p">;</span>

<span class="n">figure</span>
<span class="s">pcolor(xm,</span><span class="w"> </span><span class="s">yt,</span><span class="w"> </span><span class="s">squeeze(curu(:,:,k))&#39;);</span>
<span class="s">shading flat; axis equal tight; colorbar</span>
<span class="s">xlabel(&#39;$x$</span><span class="w"> </span><span class="s">[m]&#39;, &#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="s">ylabel(&#39;$y$</span><span class="w"> </span><span class="s">[m]&#39;, &#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="s">title([&#39;$u(x,</span><span class="w"> </span><span class="s">y,</span><span class="w"> </span><span class="s">z=&#39;, num2str(zt(k), &#39;%8.1f&#39;), &#39;m,</span><span class="w"> </span><span class="s">t=&#39;, num2str(t(n), &#39;%8.0f&#39;),&#39;s)$&#39;], &#39;Interpreter&#39;,&#39;latex</span><span class="o">&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_5.png" src="../udales-fields-tutorial_media/figure_5.png" /></p>
<div class="highlight"><pre><span></span><code><span class="nb">figure</span>
<span class="nb">pcolor</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span><span class="w"> </span><span class="n">zt</span><span class="p">,</span><span class="w"> </span><span class="nb">squeeze</span><span class="p">(</span><span class="n">curu</span><span class="p">(:,</span><span class="nb">j</span><span class="p">,:))</span><span class="o">&#39;</span><span class="p">);</span>
<span class="n">shading</span><span class="w"> </span><span class="s">flat</span><span class="p">;</span><span class="w"> </span><span class="n">axis</span><span class="w"> </span><span class="s">equal</span><span class="w"> </span><span class="s">tight</span><span class="p">;</span><span class="w"> </span><span class="n">colorbar</span>
<span class="s">xlabel(&#39;$x$ [m]&#39;,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;,&#39;latex&#39;)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;$y$ [m]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">title</span><span class="p">([</span><span class="s">&#39;$u(x, y, z=&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">zt</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;%8.1f&#39;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;m, t=&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;%8.0f&#39;</span><span class="p">),</span><span class="s">&#39;s)$&#39;</span><span class="p">],</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_6.png" src="../udales-fields-tutorial_media/figure_6.png" /></p>
<h2 id="load_slice-loading-instantaneous-2d-slice-data">load_slice: loading instantaneous 2D slice data<a class="headerlink" href="#load_slice-loading-instantaneous-2d-slice-data" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nb">help</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_slice</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>--- help for udbase/load_slice ---

  A method to retrieve instantaneous 2D slices from from the slicedump file.

  load_slice(obj) displays information, option chooses plane.

  load_slice(obj, ...)

  Example (view contents of output of horizontal slice):
     obj = udbase(expnr);
     obj.load_slice(&#39;k&#39;);
</code></pre></div>
<p>The instantaneous slice data is stored in the <code>Xslicedump.expnr.nc</code> file. This file contains particular slices of the 3D instantaneous data, which makes this data particularly suitable for creating animations since the output frequency can be much higher than for 3D fields as the filesize will remain much more manageable.</p>
<p>uDALES is capable of outputting slices along the <code>x</code>, <code>y</code> or <code>z</code>-direction. In this particular simulation, we requested to output horizontal slices (fixed height in vertical direction using an index <code>kslice</code>, e.g., <code>zm(kslice)</code>) using the input parameter:</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">lkslicedump</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ans = 1
</code></pre></div>
<p>at index</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">kslice</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ans = 21
</code></pre></div>
<p>and output instantaneous slices at time-intervals</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">tsample</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ans = 3
</code></pre></div>
<p>The first argument to the load_slice method is the slice direction:</p>
<ul>
<li>'<code>i</code>': vertical slices taken at fixed <code>x</code>. Outputs data that is a function of <code>y,z</code> and <code>t</code>.</li>
<li>'<code>j</code>': vertical slices taken at fixed <code>y</code>. Outputs data that is a function of <code>x,z</code> and <code>t</code>.</li>
<li>'<code>k</code>': horizontal slices taken at fixed <code>z</code>. Outputs data that is a function of <code>x,y</code> and <code>t</code>.</li>
</ul>
<p>To list all the variables stored in <code>kslicedump.expnr.nc</code>, we use</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">load_slice</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Contents of kslicedump.110.nc:
       Name                     Description                   Units        Size         Dimensions
    __________    ________________________________________    _____    ____________    ____________

    qt_kslice     Specific humidity at kslice                   -      128x128x1979    xt, yt, time
    thl_kslice    Potential temperature at kslice               -      128x128x1979    xt, yt, time
    time          Time                                          s      1979            time
    u_kslice      Streamwise velocity at kslice                 -      128x128x1979    xm, yt, time
    v_kslice      Spanwise velocity at kslice                   -      128x8x1979      xt, ym, time
    w_kslice      Vertical velocity at kslice                   -      128x128x1979    xt, yt, time
    xm            West-East displacement of cell edges          m      128             xm
    xt            West-East displacement of cell centers        m      128             xt
    yt            South-North displacement of cell centers      m      128             yt
</code></pre></div>
<p>This horizontal slice is at <code>z = zm(sim.kslice)</code> or <code>z = zt(sim.kslice)</code>, depending on the variable.</p>
<p>To load the data, we specify the variables we wish to load:</p>
<div class="highlight"><pre><span></span><code><span class="n">xm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_slice</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;xm&#39;</span><span class="p">);</span>
<span class="n">yt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_slice</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;yt&#39;</span><span class="p">);</span>
<span class="n">uk</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_slice</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;u_kslice&#39;</span><span class="p">);</span>
<span class="n">t</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_slice</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;time&#39;</span><span class="p">);</span>
</code></pre></div>
<p>We plot this horizontal slice of the instantaneous velocity at the last output time:</p>
<div class="highlight"><pre><span></span><code><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w"> </span><span class="c">% choose the last time-step</span>

<span class="c">% Replace the data at building locations with NaNs</span>
<span class="n">curu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">squeeze</span><span class="p">(</span><span class="n">uk</span><span class="p">(:,:,</span><span class="n">n</span><span class="p">));</span>
<span class="n">curu</span><span class="p">(</span><span class="nb">squeeze</span><span class="p">(</span><span class="n">sim</span><span class="p">.</span><span class="n">Su</span><span class="p">(:,:,</span><span class="n">sim</span><span class="p">.</span><span class="n">kslice</span><span class="p">)))</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">NaN</span><span class="p">;</span>

<span class="c">% note that the squeeze command is not formally needed here, but they will</span>
<span class="c">% be needed when considering i and j slices.</span>

<span class="c">% plot the data</span>
<span class="nb">figure</span>
<span class="nb">pcolor</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">,</span><span class="w"> </span><span class="n">curu</span><span class="o">&#39;</span><span class="p">);</span>
<span class="n">shading</span><span class="w"> </span><span class="s">flat</span><span class="p">;</span><span class="w"> </span><span class="n">axis</span><span class="w"> </span><span class="s">equal</span><span class="w"> </span><span class="s">tight</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;$x$ [m]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;$y$ [m]&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
<span class="nb">colorbar</span>
<span class="nb">title</span><span class="p">([</span><span class="s">&#39;$u(x,y,z=&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">zm</span><span class="p">(</span><span class="n">sim</span><span class="p">.</span><span class="n">kslice</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;%8.1f&#39;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;m, t=&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;%8.0f&#39;</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;s)$&#39;</span><span class="p">],</span><span class="w"> </span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;latex&#39;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="figure_7.png" src="../udales-fields-tutorial_media/figure_7.png" /></p>
<h2 id="load_stat_tree-and-plot_tree-loading-and-plotting-tree-data">load_stat_tree and plot_tree: loading and plotting tree data<a class="headerlink" href="#load_stat_tree-and-plot_tree-loading-and-plotting-tree-data" title="Permanent link">&para;</a></h2>
<p>We next switch to a tree simulation to show the tree functions example</p>
<div class="highlight"><pre><span></span><code><span class="nb">clear</span><span class="w"> </span><span class="n">variables</span><span class="p">;</span>
<span class="n">expnr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">525</span><span class="p">;</span>
<span class="n">expdir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;path_to_experiments\525&#39;</span><span class="p">;</span>

<span class="n">sim</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">udbase</span><span class="p">(</span><span class="n">expnr</span><span class="p">,</span><span class="w"> </span><span class="n">expdir</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Warning: One or more solid_(u,v,w,c).525 files not found.
</code></pre></div>
<p>The trees patches can be plotted using</p>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">plot_trees</span><span class="p">;</span>
</code></pre></div>
<p><img alt="figure_8.png" src="../udales-fields-tutorial_media/figure_8.png" /></p>
<p>The time-averaged tree source data is stored in the <code>treedump.expnr.nc</code> file. The variables it contains can be listed as:</p>
<div class="highlight"><pre><span></span><code><span class="nb">help</span><span class="w"> </span><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_tree</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>--- help for udbase/load_stat_tree ---

  A method to retrieve time-averaged statistics of the tree
  source terms from the treedump file

  load_stat_tree(OBJ) displays the variables in the treedump file

  load_stat_tree(OBJ, svar) retrieves a variable from the treedump file

  Example (view contents of output):
    obj = udbase(expnr);
    obj.load_stat_tree();
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">sim</span><span class="p">.</span><span class="n">load_stat_tree</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Contents of treedump.525.nc:
      Name                    Description                    Units         Size           Dimensions
    ________    ________________________________________    _______    ____________    ________________

    time        Time                                        s          4               time
    tr_omega    Decoupling factor                           -          512x256x64x4    xt, yt, zt, time
    tr_qt       Moisture source sink                        1/s        512x256x64x4    xt, yt, zt, time
    tr_qtA      Moisture source sink                        1/s        512x256x64x4    xt, yt, zt, time
    tr_qtR      Moisture source sink                        1/s        512x256x64x4    xt, yt, zt, time
    tr_sv1      Scalar source sink                          kg/m^3s    512x256x64x4    xt, yt, zt, time
    tr_sv2      Scalar source sink                          kg/m^3s    512x256x64x4    xt, yt, zt, time
    tr_thl      Temp source/ sink                           K/s        512x256x64x4    xt, yt, zt, time
    tr_u        Drag in x                                   m/s^2      512x256x64x4    xt, yt, zt, time
    tr_v        Drag in y                                   m/s^2      512x256x64x4    xt, yt, zt, time
    tr_w        Drag in z                                   m/s^2      512x256x64x4    xt, yt, zm, time
    xt          West-East displacement of cell centers      m          512             xt
    yt          South-North displacement of cell centers    m          256             yt
    zm          Vertical displacement of cell edges         m          64              zm
    zt          Vertical displacement of cell centers       m          64              zt
</code></pre></div>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<p>[1] Ferziger JH, Peric M (1999) Computational methods for fluid dynamics (3<sup>rd</sup> ed.). Springer.</p>
<p>[2] Oke TR, Mills G, Christen A, Voogt JA (2017) Urban Climates. Cambridge University Press.</p>
<p>[3] Schmid M, Lawrence GA, Parlange MB, Giometto MG (2019) Volume averaging for urban canopies. <em>Bound-Lay. Met.</em> <strong>173</strong>, 349-372.</p>
<p>[4] Suetzl BS, Rooney GG,  van Reeuwijk M (2020) Drag Distribution in Idealized Heterogeneous Urban Environments. <em>Bound-Lay. Met.</em> <strong>178</strong>,225-248.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      The uDALES Team
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>