#PBS -l walltime=${walltime}
#PBS -l select=${nnode}:ncpus=${ncpu}:mem=${mem}

echo "starting job.${exp}."

## load modules required for the execution
module load git/2.14.3 cmake/3.14.0 netcdf/4.5.2-fortran

## copy files to execution and output directory
mkdir $EPHEMERAL/${exp}
cp ${exppath}/* $EPHEMERAL/${exp}

## go to execution and output directory
cd $EPHEMERAL/${exp}

## in case it crashes, store debug snapshot file
# export f77_dump_flag=TRUE

## execute program with mpi
mpiexec -n $(( ${ncpu} * ${nnode} )) ${executable} $EPHEMERAL/${exp}/namoptions.${exp} > $EPHEMERAL/${exp}/output.${exp} 2>&1

## merge output files from cores to one file
${utilpath}/mergehelper.sh ${exp}

echo "job.${exp} done."